| [Korean ğŸ‡°ğŸ‡·](#korean) | [Japanese ğŸ‡¯ğŸ‡µ](#japanese) |
| :---: | :---: |

</div>

---

<div id="korean">

### ğŸ‡°ğŸ‡· Korean Version

# ğŸ” STM32 ê¸°ë°˜ ì•„ë‚ ë¡œê·¸ ë‹¤ì´ì–¼ ê¸ˆê³  ì‹œìŠ¤í…œ  
**Analog Dial Safe System using STM32 Nucleo-F411RE**
<br>
![Image](https://github.com/user-attachments/assets/de59dc97-d225-4cbf-b465-c10919eefa60)
<br>
![Image](https://raw.githubusercontent.com/ryukb727/1st_miniproj_mini_safe/refs/heads/main/images/mini_safe_flowchart.jpg)
<br>

---

## ğŸ’¡ 1. í”„ë¡œì íŠ¸ ê°œìš”
STM32 Nucleo-F411RE ê¸°ë°˜ìœ¼ë¡œ, ê°€ë³€ì €í•­ì„ ì•„ë‚ ë¡œê·¸ ë‹¤ì´ì–¼ë¡œ í™œìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³ , PWM ì„œë³´ ëª¨í„°ë¡œ ë¬¼ë¦¬ì  ì ê¸ˆ/í•´ì œë¥¼ ìˆ˜í–‰í•˜ëŠ” ì „ì ê¸ˆê³  ì‹œìŠ¤í…œì…ë‹ˆë‹¤.  
ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ë¶€í„° ê´€ë¦¬ì ëª¨ë“œ ì „í™˜, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì´ë¥´ëŠ” ì „ ê³¼ì •ì€ **FSM ê¸°ë°˜ ìƒíƒœ ì œì–´ ë¡œì§**ìœ¼ë¡œ ì„¤ê³„í•˜ì—¬ ì•ˆì •ì„±, ë³´ì•ˆì„±, ìœ ì§€ë³´ìˆ˜ì„±ì„ ëª¨ë‘ ê°•í™”í•œ êµ¬ì¡°ë¥¼ í™•ë³´í–ˆìŠµë‹ˆë‹¤.

### ğŸ“ í•µì‹¬ ëª©í‘œ
- ì•„ë‚ ë¡œê·¸ ì…ë ¥(ADC) ê¸°ë°˜ ê¸ˆê³  ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì‹œìŠ¤í…œ êµ¬í˜„
- PWM ì„œë³´ ëª¨í„°ë¥¼ ì´ìš©í•œ ì ê¸ˆ/í•´ì œ ë©”ì»¤ë‹ˆì¦˜ ì œì–´
- ê´€ë¦¬ì ëª¨ë“œ ë„ì…ìœ¼ë¡œ ë³´ì•ˆ ê¸°ëŠ¥ í™•ì¥
- FSM ê¸°ë°˜ ìƒíƒœ ì „í™˜ êµ¬ì¡°ë¡œ ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ë³´

---

## ğŸš€ 2. ì£¼ìš” ê¸°ëŠ¥
- **ì•„ë‚ ë¡œê·¸ ë‹¤ì´ì–¼ ì…ë ¥(ADC)** â†’ 0\~4095 ê°’ì„ 10êµ¬ê°„ìœ¼ë¡œ ë‚˜ëˆ  0\~9 ìˆ«ì ìƒì„±  
- **PWM ì„œë³´ ëª¨í„° ì œì–´** â†’ 1500us(ì ê¸ˆ), 2500us(í•´ì œ)  
- **TACT Switch + EXTI ì¸í„°ëŸ½íŠ¸** â†’ ì…ë ¥ í™•ì • ë° ëª¨ë“œ ì „í™˜  
- **200ms ì†Œí”„íŠ¸ì›¨ì–´ ë””ë°”ìš´ì‹±** ì ìš© â†’ ê¸°ê³„ì‹ ìŠ¤ìœ„ì¹˜ì˜ ë…¸ì´ì¦ˆë¥¼ ì œê±°í•´ ë†’ì€ ì…ë ¥ ì‹ ë¢°ë„ë„
- **FSM ê¸°ë°˜ 4ë‹¨ê³„ ê´€ë¦¬ì ì¸ì¦ êµ¬ì¡°**
  - IDLE  
  - SUPERVISOR_INPUT  
  - CURRENT_INPUT  
  - NEW_PASSWORD_INPUT  

---

## ğŸ›  3. ê°œë°œ í™˜ê²½ ë° ê¸°ìˆ  ìŠ¤íƒ
![STM32](https://img.shields.io/badge/MCU-STM32F411RE-03234B?style=for-the-badge&logo=stmicroelectronics&logoColor=white)
![C](https://img.shields.io/badge/Language-C-00599C?style=for-the-badge&logo=c&logoColor=white)
![HAL](https://img.shields.io/badge/STM32-HAL%20Library-03234B?style=for-the-badge&logo=stmicroelectronics&logoColor=white)
![ADC](https://img.shields.io/badge/Input-ADC%20(Potentiometer)-A2C93A?style=for-the-badge)
![PWM](https://img.shields.io/badge/Output-PWM%20Servo%20Motor-FFB400?style=for-the-badge)
![LCD](https://img.shields.io/badge/I2C-16x2%20LCD-1E90FF?style=for-the-badge)
![TACT](https://img.shields.io/badge/Interaction-TACT%20Switch%20Ã—%202-555555?style=for-the-badge)
![EXTI](https://img.shields.io/badge/Interrupt-EXTI%20(External%20Interrupt)-8A2BE2?style=for-the-badge)
![FSM](https://img.shields.io/badge/Architecture-FSM%20(State%20Machine)-4CAF50?style=for-the-badge)

---

## ğŸ§© 4. ì‹œìŠ¤í…œ êµ¬ì¡°
- **ADC** : ê°€ë³€ì €í•­ ê°’ â†’ 0\~9 ìˆ«ì ë³€í™˜  
- **PWM** : ì„œë³´ ëª¨í„° ê°ë„ ì œì–´ë¡œ ì ê¸ˆ/í•´ì œ ìˆ˜í–‰  
- **EXTI** : ë²„íŠ¼ ì…ë ¥ ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬  
- **LCD** : ì¸ì¦ ì§„í–‰ ìƒíƒœ/ìˆ«ì ì‹¤ì‹œê°„ í‘œì‹œ  
- **FSM** : ì•ˆì •ì ì¸ ë¹„ë°€ë²ˆí˜¸í˜¸ ê²€ì¦Â·ë³€ê²½ íë¦„ ì œì–´  

---

## ğŸ“˜ 5. í•µì‹¬ êµ¬í˜„

### 1) FSM ê¸°ë°˜ 4ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¸ì¦ ë¡œì§  
ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê³¼ì •ì˜ **ë³´ì•ˆì„±ê³¼ ì•ˆì •ì„±**ì„ í™•ë³´í•˜ê¸° ìœ„í•´ ìƒíƒœë¥¼ ëª…í™•íˆ ë¶„ë¦¬í•˜ì—¬ êµ¬í˜„

| State (security_mode) | ì„¤ëª… | TACT 2 ì…ë ¥ ì‹œ ë¡œì§ |
|-----------------------|------|----------------------|
| **IDLE** | ê¸°ë³¸ ì ê¸ˆ/ëŒ€ê¸° ìƒíƒœ | SUPERVISOR_INPUTìœ¼ë¡œ ì „í™˜ |
| **SUPERVISOR_INPUT** | ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë‹¨ê³„ | ê´€ë¦¬ì PW ê²€ì¦ â†’ ì„±ê³µ ì‹œ CURRENT_INPUT ì „í™˜ |
| **CURRENT_INPUT** | í˜„ì¬ ê¸ˆê³  ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë‹¨ê³„ | PW ê²€ì¦ â†’ ì„±ê³µ ì‹œ NEW_PASSWORD_INPUT ì „í™˜ |
| **NEW_PASSWORD_INPUT** | ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë° ì €ì¥ | password[]ì— ì €ì¥(set_password()) í›„ IDLE ë³µê·€ |

### 2) TACT ìŠ¤ìœ„ì¹˜ ë””ë°”ìš´ì‹± ì²˜ë¦¬ (ì†Œí”„íŠ¸ì›¨ì–´ì  ì•ˆì •í™”)  
ê¸°ê³„ì‹ ìŠ¤ìœ„ì¹˜ì˜ **ì±„í„°ë§(Chattering)** ë¬¸ì œë¥¼ ì†Œí”„íŠ¸ì›¨ì–´ ë””ë°”ìš´ì‹±ìœ¼ë¡œ í•´ê²°í•´ ì…ë ¥ ì‹ ë¢°ì„± ê°•í™”
ì¸í„°ëŸ½íŠ¸ ë°œìƒ ì‹œ, 200ms ì´ë‚´ì˜ ì¤‘ë³µ ì…ë ¥ì€ ëª¨ë‘ ë¬´ì‹œ

**êµ¬í˜„ ìœ„ì¹˜:** `HAL_GPIO_EXTI_Callback()`  

```c
if (now - last_press_time_tact1 > 200) {   // 200ms ë””ë°”ìš´ìŠ¤
    handle_tact1();
    last_press_time_tact1 = now;
}
```

### 3) ì•„ë‚ ë¡œê·¸ ë‹¤ì´ì–¼ ì…ë ¥ â†’ ìˆ«ì ë³€í™˜ (ADC ì•ˆì •í™”)

ê°€ë³€ ì €í•­ì˜ ì•„ë‚ ë¡œê·¸ ê°’(0\~4095)ì„ **ADC ì¸í„°ëŸ½íŠ¸**ë¡œ ì½ê³ ,  
ì´ë¥¼ 10ê°œì˜ ê· ë“±í•œ êµ¬ê°„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ **0\~9 ì •ìˆ˜(adc_val)** ë¡œ ë§¤í•‘  
ë…¸ì´ì¦ˆë¡œ ì¸í•œ ê°’ ë¶ˆì•ˆì •ì„±ì„ ì œê±°í•´ **ì•ˆì •ì ì¸ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥** ê°€ëŠ¥

**êµ¬í˜„ ìœ„ì¹˜:** `HAL_ADC_ConvCpltCallback()`

```c
if (val < 200)      adc_val = 0;
else if (val < 500) adc_val = 1;
// ...
else if (val < 4000) adc_val = 8;
else                 adc_val = 9;
```

### 4) PWM ê¸°ë°˜ ì ê¸ˆ/í•´ì œ ì œì–´

Timer ê¸°ë°˜ PWM ì‹ í˜¸ë¡œ ì„œë³´ ëª¨í„°ì˜ ê°ë„ ì •ë°€ ì œì–´  
ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ê²°ê³¼ì— ë”°ë¼ ì„œë³´ ëª¨í„°ê°€ **ì ê¸ˆ(Lock)** ë˜ëŠ” **í•´ì œ(Unlock)** ìœ„ì¹˜ë¡œ ì´ë™

- **ì ê¸ˆ(Lock)** : 1500us  
- **í•´ì œ(Unlock)** : 2500us  

```c
__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 1500);  // Lock
__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 2500);  // Unlock
```
---

## ğŸ 6. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1) **ADC ì…ë ¥ ë…¸ì´ì¦ˆë¡œ ìˆ«ì íŠ**
- ë¬¸ì œ: ê°’ ë³€ë™ìœ¼ë¡œ ìˆ«ìê°€ ë¶ˆì•ˆì •  
- í•´ê²°: 10êµ¬ê°„ ê³ ì • ë§¤í•‘ + ì¸í„°ëŸ½íŠ¸ ê¸°ë°˜ ì•ˆì •í™”  
- ê²°ê³¼: ë‹¤ì´ì–¼ ì›€ì§ì„ì´ ë¶€ë“œëŸ½ê³  ì •í™•í•˜ê²Œ í‘œì‹œë¨  

### 2) **TACT ë²„íŠ¼ ì¤‘ë³µ ì…ë ¥ (ì±„í„°ë§)**
- ë¬¸ì œ: ë²„íŠ¼ 1íšŒ ì…ë ¥ â†’ ë‹¤ì¤‘ ì¸í„°ëŸ½íŠ¸ ë°œìƒ  
- í•´ê²°: ì¸í„°ëŸ½íŠ¸ ì½œë°±ì— 200ms ë””ë°”ìš´ì‹± ì ìš©  
- ê²°ê³¼: ì…ë ¥ ì´ë²¤íŠ¸ ì •í™•íˆ 1íšŒë§Œ ì²˜ë¦¬ë¨  

### 3) **ê´€ë¦¬ì ëª¨ë“œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê³¼ì •ì—ì„œ ìƒíƒœ ê¼¬ì„**
- ë¬¸ì œ: insert_num ì´ˆê¸°í™” ëˆ„ë½ / FSM íë¦„ ë¶ˆëª…í™•  
- í•´ê²°: 4ë‹¨ê³„ FSM ì¬ì •ì˜ + ëª¨ë“  ë¶„ê¸°ì—ì„œ reset_nums() í˜¸ì¶œ  
- ê²°ê³¼: ì•ˆì •ì ì¸ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ  

---

## ğŸ™‹â€â™‚ï¸ 7. ë‹´ë‹¹ ì—­í• 
- ì•„ë‚ ë¡œê·¸ ë‹¤ì´ì–¼ ê¸°ë°˜ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë¡œì§ ì „ì²´ êµ¬í˜„  
- ADC â†’ ìˆ«ì ë§¤í•‘ / insert_num ë°°ì—´ êµ¬ì¡° ì„¤ê³„  
- ê´€ë¦¬ì ëª¨ë“œ í¬í•¨ FSM 4ë‹¨ê³„ ì¸ì¦ ì‹œìŠ¤í…œ ê°œë°œ  
- EXTI + ë””ë°”ìš´ì‹±(200ms) ë²„íŠ¼ ë¡œì§ êµ¬í˜„

---

## ğŸ“„ 8. í”„ë¡œì íŠ¸ ê²°ê³¼ ë° ë°°ìš´ ì 
- FSM êµ¬ì¡° ì„¤ê³„ë¥¼ í†µí•œ í™•ì¥ ê°€ëŠ¥ ì‹œìŠ¤í…œ êµ¬ì¶•
- ADCÂ·EXTIÂ·I2C í†µí•© ì œì–´ ê²½í—˜ ê°•í™”
- í•˜ë“œì›¨ì–´ ë…¸ì´ì¦ˆÂ·ì±„í„°ë§ ë“± ì‹¤ì œ ì„ë² ë””ë“œ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥
- HW/SW í†µí•© ë””ë²„ê¹… ëŠ¥ë ¥ í–¥ìƒ  

---
#### ğŸ“– í”„ë¡œì íŠ¸ ë…¸ì…˜ URL
https://www.notion.so/hiawath/7-242c59623e6180f1a17bd6faf05222ce

---

<div align="center">
<a href="#japanese">â¬‡ï¸ æ—¥æœ¬èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¸ç§»å‹• (Go to Japanese Version) â¬‡ï¸</a>
</div>

</div>

---

<div id="japanese">

### ğŸ‡¯ğŸ‡µ Japanese Version

# ğŸ” STM32ãƒ™ãƒ¼ã‚¹ ã‚¢ãƒŠãƒ­ã‚°ãƒ€ã‚¤ãƒ¤ãƒ«é‡‘åº«ã‚·ã‚¹ãƒ†ãƒ 
Analog Dial Safe System using STM32 Nucleo-F411RE
<br>
![Image](https://github.com/user-attachments/assets/de59dc97-d225-4cbf-b465-c10919eefa60)
<br>
![Image](https://raw.githubusercontent.com/ryukb727/1st_miniproj_mini_safe/refs/heads/main/images/mini_safe_flowchart.jpg)
<br>


## ğŸ’¡ 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€STM32 Nucleo-F411REã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ã€å¯å¤‰æŠµæŠ—å™¨ã‚’ã‚¢ãƒŠãƒ­ã‚°ãƒ€ã‚¤ãƒ¤ãƒ«ã¨ã—ã¦æ´»ç”¨ã—ã¦æš—è¨¼ç•ªå·ã‚’å…¥åŠ›ã—ã€PWMã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ã§ç‰©ç†çš„ãªãƒ­ãƒƒã‚¯/è§£é™¤ã‚’è¡Œã†é›»å­é‡‘åº«ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚  
æš—è¨¼ç•ªå·å…¥åŠ›ã‹ã‚‰ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã¸ã®åˆ‡ã‚Šæ›¿ãˆã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã«è‡³ã‚‹å…¨éç¨‹ã¯ã€**FSM (æœ‰é™çŠ¶æ…‹æ©Ÿæ¢°) ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯**ã§è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€å®‰å®šæ€§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ä¿å®ˆæ€§ã‚’å¼·åŒ–ã—ãŸæ§‹é€ ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™ã€‚

### ğŸ“ ä¸»è¦ç›®æ¨™

- ã‚¢ãƒŠãƒ­ã‚°å…¥åŠ›ï¼ˆADCï¼‰ã«åŸºã¥ã„ãŸé‡‘åº«æš—è¨¼ç•ªå·å…¥åŠ›ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
- PWMã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’ç”¨ã„ãŸãƒ­ãƒƒã‚¯/è§£é™¤ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®åˆ¶å¾¡
- ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã®å°å…¥ã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã®æ‹¡å¼µ
- FSMãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹é·ç§»æ§‹é€ ã«ã‚ˆã‚‹ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§ã®ç¢ºä¿

---

## ğŸš€ 2. ä¸»è¦æ©Ÿèƒ½

- **ã‚¢ãƒŠãƒ­ã‚°ãƒ€ã‚¤ãƒ¤ãƒ«å…¥åŠ› (ADC)** â†’ 0ï½4095ã®å€¤ã‚’10åŒºé–“ã«åˆ†ã‘ã¦0ï½9ã®æ•°å­—ã‚’ç”Ÿæˆ
- **PWMã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼åˆ¶å¾¡** â†’ 1500usï¼ˆãƒ­ãƒƒã‚¯ï¼‰ã€2500usï¼ˆè§£é™¤ï¼‰
- **TACTã‚¹ã‚¤ãƒƒãƒ + EXTIå‰²ã‚Šè¾¼ã¿** â†’ å…¥åŠ›ç¢ºå®šãŠã‚ˆã³ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
- **200ms ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã®é©ç”¨** â†’ æ©Ÿæ¢°å¼ã‚¹ã‚¤ãƒƒãƒã®ãƒã‚¤ã‚ºã‚’é™¤å»ã—ã€ä¿¡é ¼æ€§ã®é«˜ã„å…¥åŠ›
- **FSMãƒ™ãƒ¼ã‚¹ã®4æ®µéšç®¡ç†è€…èªè¨¼æ§‹é€ **
  - IDLE
  - SUPERVISOR_INPUT
  - CURRENT_INPUT
  - NEW_PASSWORD_INPUT

---

## ğŸ›  3. é–‹ç™ºç’°å¢ƒãŠã‚ˆã³æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

![STM32](https://img.shields.io/badge/MCU-STM32F411RE-03234B?style=for-the-badge&logo=stmicroelectronics&logoColor=white)
![C](https://img.shields.io/badge/Language-C-00599C?style=for-the-badge&logo=c&logoColor=white)
![HAL](https://img.shields.io/badge/STM32-HAL%20Library-03234B?style=for-the-badge&logo=stmicroelectronics&logoColor=white)
![ADC](https://img.shields.io/badge/Input-ADC%20(Potentiometer)-A2C93A?style=for-the-badge)
![PWM](https://img.shields.io/badge/Output-PWM%20Servo%20Motor-FFB400?style=for-the-badge)
![LCD](https://img.shields.io/badge/I2C-16x2%20LCD-1E90FF?style=for-the-badge)
![TACT](https://img.shields.io/badge/Interaction-TACT%20Switch%20Ã—%202-555555?style=for-the-badge)
![EXTI](https://img.shields.io/badge/Interrupt-EXTI%20(External%20Interrupt)-8A2BE2?style=for-the-badge)
![FSM](https://img.shields.io/badge/Architecture-FSM%20(State%20Machine)-4CAF50?style=for-the-badge)

---

## ğŸ§© 4. ã‚·ã‚¹ãƒ†ãƒ æ§‹é€ 

- **ADC** : å¯å¤‰æŠµæŠ—å€¤ â†’ 0ï½9ã®æ•°å­—å¤‰æ›
- **PWM** : ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ã®è§’åº¦åˆ¶å¾¡ã«ã‚ˆã‚‹ãƒ­ãƒƒã‚¯/è§£é™¤
- **EXTI** : ãƒœã‚¿ãƒ³å…¥åŠ›ã®å‰²ã‚Šè¾¼ã¿å‡¦ç†
- **LCD** : èªè¨¼é€²è¡ŒçŠ¶æ…‹/æ•°å­—ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
- **FSM** : å®‰å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ãƒ»å¤‰æ›´ãƒ•ãƒ­ãƒ¼ã®åˆ¶å¾¡

---

## ğŸ“˜ 5. ä¸»è¦ãªå®Ÿè£…

### 1) FSMãƒ™ãƒ¼ã‚¹ 4æ®µéšãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´éç¨‹ã®**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨å®‰å®šæ€§**ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã«ã€çŠ¶æ…‹ã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã¦å®Ÿè£…

| State (security_mode) | èª¬æ˜                      | TACT 2 å…¥åŠ›æ™‚ã®ãƒ­ã‚¸ãƒƒã‚¯                          |
|-----------------------|---------------------------|--------------------------------------------------|
| **IDLE**              | åŸºæœ¬çš„ãªãƒ­ãƒƒã‚¯/å¾…æ©ŸçŠ¶æ…‹    | SUPERVISOR_INPUTã¸é·ç§»                           |
| **SUPERVISOR_INPUT**  | ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›æ®µéš  | ç®¡ç†è€…PWã‚’æ¤œè¨¼ â†’ æˆåŠŸæ™‚ã«CURRENT_INPUTã¸é·ç§»  |
| **CURRENT_INPUT**     | ç¾åœ¨ã®é‡‘åº«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªæ®µéš | PWã‚’æ¤œè¨¼ â†’ æˆåŠŸæ™‚ã«NEW_PASSWORD_INPUTã¸é·ç§» |
| **NEW_PASSWORD_INPUT**| æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ãŠã‚ˆã³ä¿å­˜ | password[]ã«ä¿å­˜(set_password())å¾Œã€IDLEã¸å¾©å¸° |

### 2) TACTã‚¹ã‚¤ãƒƒãƒã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç† (ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢çš„å®‰å®šåŒ–)

æ©Ÿæ¢°å¼ã‚¹ã‚¤ãƒƒãƒã®**ãƒãƒ£ã‚¿ãƒªãƒ³ã‚° (Chattering)** å•é¡Œã‚’**ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‡ãƒã‚¦ãƒ³ã‚¹**ã§è§£æ±ºã—ã€å…¥åŠ›ã®ä¿¡é ¼æ€§ã‚’å¼·åŒ–  
EXTI(å¤–éƒ¨å‰²ã‚Šè¾¼ã¿)ç™ºç”Ÿæ™‚ã€200msä»¥å†…ã®é‡è¤‡å…¥åŠ›ã¯ã™ã¹ã¦ç„¡è¦–

å®Ÿè£…ç®‡æ‰€: HAL_GPIO_EXTI_Callback()

```c
if (now - last_press_time_tact1 > 200) {   // 200ms ë””ë°”ìš´ìŠ¤
    handle_tact1();
    last_press_time_tact1 = now;
}
```

### 3) ã‚¢ãƒŠãƒ­ã‚°ãƒ€ã‚¤ãƒ¤ãƒ«å…¥åŠ› â†’ æ•°å­—å¤‰æ› (ADCå®‰å®šåŒ–)

å¯å¤‰æŠµæŠ—ã®ã‚¢ãƒŠãƒ­ã‚°å€¤ (0ï½4095) ã‚’**ADCå‰²ã‚Šè¾¼ã¿**ã§èª­ã¿å–ã‚Šã€ã“ã‚Œã‚’10å€‹ã®å‡ç­‰ãªåŒºé–“ã«åˆ†ã‘ã¦**0ï½9ã®æ•´æ•° (adc_val)** ã«ãƒãƒƒãƒ”ãƒ³ã‚°  
ãƒã‚¤ã‚ºã«ã‚ˆã‚‹å€¤ã®ä¸å®‰å®šæ€§ã‚’é™¤å»ã—ã€**æš—è¨¼ç•ªå·å…¥åŠ›å®‰å®šåŒ–**

å®Ÿè£…ç®‡æ‰€: HAL_ADC_ConvCpltCallback()

```c
if (val < 200)      adc_val = 0;
else if (val < 500) adc_val = 1;
// ...
else if (val < 4000) adc_val = 8;
else                 adc_val = 9;
```

### 4) PWMãƒ™ãƒ¼ã‚¹ã®ãƒ­ãƒƒã‚¯/è§£é™¤åˆ¶å¾¡

ã‚¿ã‚¤ãƒãƒ¼ãƒ™ãƒ¼ã‚¹ã®PWMä¿¡å·ã§ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ã®è§’åº¦ã‚’ç²¾å¯†ã«åˆ¶å¾¡  
æš—è¨¼ç•ªå·ã®æ¤œè¨¼çµæœã«åŸºã¥ãã€ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ãŒ**ãƒ­ãƒƒã‚¯ (Lock)** ã¾ãŸã¯ **è§£é™¤ (Unlock)** ä½ç½®ã¸ç§»å‹•

ãƒ­ãƒƒã‚¯ (Lock) : 1500us  
è§£é™¤ (Unlock) : 2500us

```c
__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 1500);  // Lock
__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 2500);  // Unlock
```
---

## ğŸ 6. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 1) ADCå…¥åŠ›ãƒã‚¤ã‚ºã«ã‚ˆã‚‹æ•°å­—ã®é£›ã³
- **å•é¡Œ**: å€¤ã®å¤‰å‹•ã«ã‚ˆã‚Šæ•°å­—ãŒä¸å®‰å®š
- **è§£æ±ºç­–**: 10åŒºé–“ã®å›ºå®šãƒãƒƒãƒ”ãƒ³ã‚° + å‰²ã‚Šè¾¼ã¿ãƒ™ãƒ¼ã‚¹ã®å®‰å®šåŒ–
- **çµæœ**: ãƒ€ã‚¤ãƒ¤ãƒ«ã®å‹•ããŒã‚¹ãƒ ãƒ¼ã‚ºã‹ã¤æ­£ç¢ºã«è¡¨ç¤ºã•ã‚Œã‚‹

### 2) TACTãƒœã‚¿ãƒ³ã®é‡è¤‡å…¥åŠ› (ãƒãƒ£ã‚¿ãƒªãƒ³ã‚°)
- **å•é¡Œ**: ãƒœã‚¿ãƒ³1å›å…¥åŠ› â†’ è¤‡æ•°å›ã®å‰²ã‚Šè¾¼ã¿ãŒç™ºç”Ÿ
- **è§£æ±ºç­–**: å‰²ã‚Šè¾¼ã¿ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«200msã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã‚’é©ç”¨
- **çµæœ**: å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆãŒæ­£ç¢ºã«1å›ã®ã¿å‡¦ç†ã•ã‚Œã‚‹

### 3) ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãƒ—ãƒ­ã‚»ã‚¹ã«ãŠã‘ã‚‹çŠ¶æ…‹ã®æ··ä¹±
- **å•é¡Œ**: insert_numã®åˆæœŸåŒ–æ¼ã‚Œ / FSMãƒ•ãƒ­ãƒ¼ã®ä¸æ˜ç¢ºã•
- **è§£æ±ºç­–**: 4æ®µéšFSMã®å†å®šç¾© + ã™ã¹ã¦ã®åˆ†å²ã§reset_nums()ã‚’å‘¼ã³å‡ºã—
- **çµæœ**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãŒå®‰å®šã—ã¦å‹•ä½œã™ã‚‹

---

## ğŸ™‹â€â™‚ï¸ 7. æ‹…å½“å½¹å‰²

- ã‚¢ãƒŠãƒ­ã‚°ãƒ€ã‚¤ãƒ¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®PWå…¥åŠ›ãƒ­ã‚¸ãƒƒã‚¯å…¨ä½“ã®å®Ÿè£…
- ADC â†’ æ•°å­—ãƒãƒƒãƒ”ãƒ³ã‚° / insert_numé…åˆ—æ§‹é€ ã®è¨­è¨ˆ
- ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã‚’å«ã‚€FSM 4æ®µéšèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®é–‹ç™º
- EXTI + ãƒ‡ãƒã‚¦ãƒ³ã‚¹ (200ms) ãƒœã‚¿ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…

---

## ğŸ“„ 8. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµæœã¨å­¦ã‚“ã ã“ã¨

- FSMæ§‹é€ è¨­è¨ˆã«ã‚ˆã‚‹æ‹¡å¼µå¯èƒ½ãªã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
- ADCãƒ»EXTIãƒ»I2Cã®çµ±åˆåˆ¶å¾¡çµŒé¨“ã®å¼·åŒ–
- ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒã‚¤ã‚ºãƒ»ãƒãƒ£ã‚¿ãƒªãƒ³ã‚°ãªã©ã®å®Ÿéš›çš„ãªçµ„ã¿è¾¼ã¿å•é¡Œè§£æ±ºèƒ½åŠ›
- HW/SWçµ±åˆãƒ‡ãƒãƒƒã‚°èƒ½åŠ›ã®å‘ä¸Š

---

## ğŸ“– ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ Notion URL
[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ Notion](https://www.notion.so/hiawath/7-242c59623e6180f1a17bd6faf05222ce)

---

<div align="center">
<a href="#korean">â¬†ï¸ éŸ“å›½èªãƒãƒ¼ã‚¸ãƒ§ãƒ³ìœ¼ë¡œ ëŒì•„ê°€ê¸° (Go back to Korean Version) â¬†ï¸</a>
</div>

</div>

---
